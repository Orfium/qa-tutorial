test_name: This is a simple test for getting the authorization token

# Explain the use of markers
marks:
  - regression
  - tavern_workshop

# Explain the syntax of stages
stages:
    - name: Get authorization token
      request:
        url: "https://restful-booker.herokuapp.com/auth"
        method: POST
        json:
          username: "admin"
          password: "password123"
      response:
        status_code: 200
        save:
          json:
           auth_token: token

---
test_name: This is a test for using the authorization request in another test

marks:
  - regression
  - tavern_workshop

stages:
  # Define a reusable stage through: - &name_of_reusable_stage
  - &get_auth_token
    name: Get authorization token
    request:
      url: "https://restful-booker.herokuapp.com/auth"
      method: POST
      json:
        username: "admin"
        password: "password123"
    response:
      status_code: 200
      save:
        json:
          auth_token: token

---
test_name: This is a test which creates a new booking

marks:
  - regression
  - tavern_workshop

stages:
  - name: Create a booking
    request:
      url: "https://restful-booker.herokuapp.com/booking"
      method: POST
      json:
        firstname: "Jim"
        lastname: "Brown"
        totalprice: 90
        depositpaid: true
        bookingdates.checkin: "2018-01-01"
        bookingdates.checkout: "2019-01-01"
        additionalneeds: "Breakfast"
    response:
      status_code: 200

